<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="prev" title="About PEG parsers" href="peg_parsers.html" />

    <meta name="generator" content="sphinx-4.0.1, furo 2021.04.11.beta34"/>
        <title>Syntax - pegen documentation</title>
      <link rel="stylesheet" href="_static/styles/furo.css?digest=59ab60ac09ea94ccfe6deddff6d715cce948a6fc">
    <link rel="stylesheet" href="_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css" />
    <link rel="stylesheet" href="_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">pegen  documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="_static/logo_simple.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="_static/logo_simple.png" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">pegen  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="peg_parsers.html">About PEG parsers</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Syntax</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <section id="syntax">
<h1>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h1>
<p>The grammar consists of a sequence of rules of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule_name</span><span class="p">:</span> <span class="n">expression</span>
</pre></div>
</div>
<p>Optionally, a type can be included right after the rule name, which
specifies the return type of the Python function corresponding to the
rule:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule_name</span><span class="p">[</span><span class="n">return_type</span><span class="p">]:</span> <span class="n">expression</span>
</pre></div>
</div>
<p>If the return type is omitted, then the return type is <code class="docutils literal notranslate"><span class="pre">Any</span></code>.</p>
<section id="grammar-expressions">
<h2>Grammar Expressions<a class="headerlink" href="#grammar-expressions" title="Permalink to this headline">¶</a></h2>
<section id="comment">
<h3><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">comment</span></code><a class="headerlink" href="#comment" title="Permalink to this headline">¶</a></h3>
<p>Python-style comments.</p>
</section>
<section id="e1-e2">
<h3><code class="docutils literal notranslate"><span class="pre">e1</span> <span class="pre">e2</span></code><a class="headerlink" href="#e1-e2" title="Permalink to this headline">¶</a></h3>
<p>Match e1, then match e2.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule_name</span><span class="p">:</span> <span class="n">first_rule</span> <span class="n">second_rule</span>
</pre></div>
</div>
</section>
<section id="e1-e2-1">
<span id="id1"></span><h3><code class="docutils literal notranslate"><span class="pre">e1</span> <span class="pre">|</span> <span class="pre">e2</span></code><a class="headerlink" href="#e1-e2-1" title="Permalink to this headline">¶</a></h3>
<p>Match e1 or e2.</p>
<p>The first alternative can also appear on the line after the rule name
for formatting purposes. In that case, a | can also be used before the
first alternative, like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule_name</span><span class="p">[</span><span class="n">return_type</span><span class="p">]:</span>
    <span class="o">|</span> <span class="n">first_alt</span>
    <span class="o">|</span> <span class="n">second_alt</span>
</pre></div>
</div>
</section>
<section id="e">
<h3><code class="docutils literal notranslate"><span class="pre">(</span> <span class="pre">e</span> <span class="pre">)</span></code><a class="headerlink" href="#e" title="Permalink to this headline">¶</a></h3>
<p>Match e.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule_name</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
<p>A slightly more complex and useful example includes using the grouping
operator together with the repeat operators:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule_name</span><span class="p">:</span> <span class="p">(</span><span class="n">e1</span> <span class="n">e2</span><span class="p">)</span><span class="o">*</span>
</pre></div>
</div>
</section>
<section id="e-or-e">
<h3><code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">e</span> <span class="pre">]</span> <span class="pre">or</span> <span class="pre">e?</span></code><a class="headerlink" href="#e-or-e" title="Permalink to this headline">¶</a></h3>
<p>Optionally match e.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule_name</span><span class="p">:</span> <span class="p">[</span><span class="n">e</span><span class="p">]</span>
</pre></div>
</div>
<p>A more useful example includes defining that a trailing comma is
optional:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule_name</span><span class="p">:</span> <span class="n">e</span> <span class="p">(</span><span class="s1">','</span> <span class="n">e</span><span class="p">)</span><span class="o">*</span> <span class="p">[</span><span class="s1">','</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="e-1">
<span id="id2"></span><h3><code class="docutils literal notranslate"><span class="pre">e*</span></code><a class="headerlink" href="#e-1" title="Permalink to this headline">¶</a></h3>
<p>Match zero or more occurrences of e.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule_name</span><span class="p">:</span> <span class="p">(</span><span class="n">e1</span> <span class="n">e2</span><span class="p">)</span><span class="o">*</span>
</pre></div>
</div>
</section>
<section id="e-2">
<span id="id3"></span><h3><code class="docutils literal notranslate"><span class="pre">e+</span></code><a class="headerlink" href="#e-2" title="Permalink to this headline">¶</a></h3>
<p>Match one or more occurrences of e.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule_name</span><span class="p">:</span> <span class="p">(</span><span class="n">e1</span> <span class="n">e2</span><span class="p">)</span><span class="o">+</span>
</pre></div>
</div>
</section>
<section id="s-e">
<h3><code class="docutils literal notranslate"><span class="pre">s.e+</span></code><a class="headerlink" href="#s-e" title="Permalink to this headline">¶</a></h3>
<p>Match one or more occurrences of e, separated by s. The generated parse
tree does not include the separator. This is otherwise identical to
<code class="docutils literal notranslate"><span class="pre">(e</span> <span class="pre">(s</span> <span class="pre">e)*)</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule_name</span><span class="p">:</span> <span class="s1">','</span><span class="o">.</span><span class="n">e</span><span class="o">+</span>
</pre></div>
</div>
</section>
<section id="e-3">
<span id="id4"></span><h3><code class="docutils literal notranslate"><span class="pre">&amp;e</span></code><a class="headerlink" href="#e-3" title="Permalink to this headline">¶</a></h3>
<p>Succeed if e can be parsed, without consuming any input.</p>
</section>
<section id="e-4">
<span id="id5"></span><h3><code class="docutils literal notranslate"><span class="pre">!e</span></code><a class="headerlink" href="#e-4" title="Permalink to this headline">¶</a></h3>
<p>Fail if e can be parsed, without consuming any input.</p>
<p>An example taken from <code class="docutils literal notranslate"><span class="pre">data/python.gram</span></code> specifies that a primary
consists of an atom, which is not followed by a <code class="docutils literal notranslate"><span class="pre">.</span></code> or a <code class="docutils literal notranslate"><span class="pre">(</span></code> or a
<code class="docutils literal notranslate"><span class="pre">[</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>primary: atom !'.' !'(' !'['
</pre></div>
</div>
</section>
<section id="e-5">
<span id="id6"></span><h3><code class="docutils literal notranslate"><span class="pre">~e</span></code><a class="headerlink" href="#e-5" title="Permalink to this headline">¶</a></h3>
<p>Commit to the current alternative, even if it fails to parse.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule_name</span><span class="p">:</span> <span class="s1">'('</span> <span class="o">~</span> <span class="n">some_rule</span> <span class="s1">')'</span> <span class="o">|</span> <span class="n">some_alt</span>
</pre></div>
</div>
<p>In this example, if a left parenthesis is parsed, then the other
alternative won’t be considered, even if some_rule or ‘)’ fail to be
parsed.</p>
</section>
<section id="e-6">
<span id="id7"></span><h3><code class="docutils literal notranslate"><span class="pre">&amp;&amp;e</span></code><a class="headerlink" href="#e-6" title="Permalink to this headline">¶</a></h3>
<p>Fail immediatly if e fails to parse by raising the exception built using
the <code class="docutils literal notranslate"><span class="pre">make_syntax_error</span></code> method.</p>
<p>This construct can help provide better error messages.</p>
</section>
</section>
<section id="keywords">
<h2>Keywords<a class="headerlink" href="#keywords" title="Permalink to this headline">¶</a></h2>
<p>Keywords are identified in the grammar as quoted names. Single quotes
<code class="docutils literal notranslate"><span class="pre">'def'</span></code> are used to identify hard keywords i.e. keywords that are
reserved in the grammar and cannot be used for any other purpose. Double
quotes <code class="docutils literal notranslate"><span class="pre">"match"</span></code> identify soft keywords that act as keyword only in
specific context. As a consequence a rule matching <code class="docutils literal notranslate"><span class="pre">NAME</span></code> may match a
soft keyword but never a hard keyword.</p>
<p>In some circumstances, it can desirable to match any soft keyword. For
those cases one can use <code class="docutils literal notranslate"><span class="pre">SOFT_KEYWORD</span></code> that will expand to
<code class="docutils literal notranslate"><span class="pre">"match"</span> <span class="pre">|</span> <span class="pre">"case"</span></code> if <code class="docutils literal notranslate"><span class="pre">match</span></code> and <code class="docutils literal notranslate"><span class="pre">case</span></code> are the only two known
soft keywords.</p>
</section>
<section id="return-value">
<h2>Return Value<a class="headerlink" href="#return-value" title="Permalink to this headline">¶</a></h2>
<p>Optionally, an alternative can be followed by a so-called action in
curly-braces, which specifies the return value of the alternative:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule_name</span><span class="p">[</span><span class="n">return_type</span><span class="p">]:</span>
    <span class="o">|</span> <span class="n">first_alt1</span> <span class="n">first_alt2</span> <span class="p">{</span> <span class="n">first_alt1</span> <span class="p">}</span>
    <span class="o">|</span> <span class="n">second_alt1</span> <span class="n">second_alt2</span> <span class="p">{</span> <span class="n">second_alt1</span> <span class="p">}</span>
</pre></div>
</div>
<p>If the action is omitted, a list with all the parsed expressions gets
returned. However if the rule contains a single element it is returned
as is without being wrapped in a list. Rules allowing to match multiple
items (<code class="docutils literal notranslate"><span class="pre">+</span></code> or <code class="docutils literal notranslate"><span class="pre">*</span></code>) always return a list.</p>
<p>By default the parser does not track line number and col offset for
production each rule. If one desires to store the start line and offset
and the end line and offset of a rule, one can add <code class="docutils literal notranslate"><span class="pre">LOCATIONS</span></code> in the
action. It will be replaced in the generated parser by the value of the
<code class="docutils literal notranslate"><span class="pre">location_formatting</span></code> argument of the parser generator, which defaults
to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lineno</span><span class="o">=</span><span class="n">start_lineno</span><span class="p">,</span> <span class="n">col_offset</span><span class="o">=</span><span class="n">start_col_offset</span><span class="p">,</span> <span class="n">end_lineno</span><span class="o">=</span><span class="n">end_lineno</span><span class="p">,</span> <span class="n">end_col_offset</span><span class="o">=</span><span class="n">end_col_offset</span>
</pre></div>
</div>
<p>The default is suitable to generate Python AST nodes.</p>
</section>
<section id="variables-in-the-grammar">
<h2>Variables in the Grammar<a class="headerlink" href="#variables-in-the-grammar" title="Permalink to this headline">¶</a></h2>
<p>A subexpression can be named by preceding it with an identifier and an
<code class="docutils literal notranslate"><span class="pre">=</span></code> sign. The name can then be used in the action, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule_name</span><span class="p">[</span><span class="n">return_type</span><span class="p">]:</span> <span class="s1">'('</span> <span class="n">a</span><span class="o">=</span><span class="n">some_other_rule</span> <span class="s1">')'</span> <span class="p">{</span> <span class="n">a</span> <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="grammar-actions">
<h2>Grammar actions<a class="headerlink" href="#grammar-actions" title="Permalink to this headline">¶</a></h2>
<p>To avoid the intermediate steps that obscure the relationship between
the grammar and the AST generation the PEG parser allows directly
generating AST nodes for a rule via grammar actions. Grammar actions are
language-specific expressions that are evaluated when a grammar rule is
successfully parsed. These expressions can be written in Python. As an
example of a grammar with Python actions, the piece of the parser
generator that parses grammar files is bootstrapped from a meta-grammar
file with Python actions that generate the grammar tree as a result of
the parsing.</p>
<p>In the specific case of the PEG grammar for Python, having actions
allows directly describing how the AST is composed in the grammar
itself, making it more clear and maintainable. This AST generation
process is supported by the use of some helper functions that factor out
common AST object manipulations and some other required operations that
are not directly related to the grammar.</p>
<p>To indicate these actions, each alternative can be followed by an action
inside curly-braces, which specifies a Python expression to be evaluated
and returned for the alternative:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule_name</span><span class="p">[</span><span class="n">return_type</span><span class="p">]:</span>
    <span class="o">|</span> <span class="n">first_alt1</span> <span class="n">first_alt2</span> <span class="p">{</span> <span class="n">first_alt1</span> <span class="p">}</span>
    <span class="o">|</span> <span class="n">second_alt1</span> <span class="n">second_alt2</span> <span class="p">{</span> <span class="n">second_alt1</span> <span class="p">}</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The code inside curly-braces can only be a Python expression (i.e. it
can be assigned to a variable).</p>
</div>
<p>If the action is omitted, a default action is generated:</p>
<ul class="simple">
<li><p>If there’s a single name in the rule in the rule, it gets returned.</p></li>
<li><p>If there is more than one name in the rule, a collection with all
parsed expressions gets returned.</p></li>
</ul>
<p>This default behaviour is primarily made for very simple situations and
for debugging purposes.</p>
<p>As an illustrative example this simple grammar file allows directly
generating a full parser that can parse simple arithmetic expressions
and that returns a valid Python AST:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">start</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">Module</span><span class="p">]:</span> <span class="n">a</span><span class="o">=</span><span class="n">expr_stmt</span><span class="o">*</span> <span class="n">ENDMARKER</span> <span class="p">{</span> <span class="n">ast</span><span class="o">.</span><span class="n">Module</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">a</span> <span class="ow">or</span> <span class="p">[]</span> <span class="p">}</span>
<span class="n">expr_stmt</span><span class="p">:</span> <span class="n">a</span><span class="o">=</span><span class="n">expr</span> <span class="n">NEWLINE</span> <span class="p">{</span> <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">EXTRA</span><span class="p">)</span> <span class="p">}</span>

<span class="n">expr</span><span class="p">:</span>
    <span class="o">|</span> <span class="n">l</span><span class="o">=</span><span class="n">expr</span> <span class="s1">'+'</span> <span class="n">r</span><span class="o">=</span><span class="n">term</span> <span class="p">{</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Add</span><span class="p">(),</span> <span class="n">right</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">EXTRA</span><span class="p">)</span> <span class="p">}</span>
    <span class="o">|</span> <span class="n">l</span><span class="o">=</span><span class="n">expr</span> <span class="s1">'-'</span> <span class="n">r</span><span class="o">=</span><span class="n">term</span> <span class="p">{</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Sub</span><span class="p">(),</span> <span class="n">right</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">EXTRA</span><span class="p">)</span> <span class="p">}</span>
    <span class="o">|</span> <span class="n">term</span>

<span class="n">term</span><span class="p">:</span>
    <span class="o">|</span> <span class="n">l</span><span class="o">=</span><span class="n">term</span> <span class="s1">'*'</span> <span class="n">r</span><span class="o">=</span><span class="n">factor</span> <span class="p">{</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Mult</span><span class="p">(),</span> <span class="n">right</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">EXTRA</span><span class="p">)</span> <span class="p">}</span>
    <span class="o">|</span> <span class="n">l</span><span class="o">=</span><span class="n">term</span> <span class="s1">'/'</span> <span class="n">r</span><span class="o">=</span><span class="n">factor</span> <span class="p">{</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Div</span><span class="p">(),</span> <span class="n">right</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">EXTRA</span><span class="p">)</span> <span class="p">}</span>
    <span class="o">|</span> <span class="n">factor</span>

<span class="n">factor</span><span class="p">:</span>
    <span class="o">|</span> <span class="s1">'('</span> <span class="n">e</span><span class="o">=</span><span class="n">expr</span> <span class="s1">')'</span> <span class="p">{</span> <span class="n">e</span> <span class="p">}</span>
    <span class="o">|</span> <span class="n">atom</span>

<span class="n">atom</span><span class="p">:</span>
    <span class="o">|</span> <span class="n">NAME</span>
    <span class="o">|</span> <span class="n">NUMBER</span>
</pre></div>
</div>
</section>
<section id="left-recursion">
<h2>Left recursion<a class="headerlink" href="#left-recursion" title="Permalink to this headline">¶</a></h2>
<p>PEG parsers normally do not support left recursion but Pegen implements
a technique that allows left recursion using the memoization cache. This
allows us to write not only simple left-recursive rules but also more
complicated rules that involve indirect left-recursion like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule1</span><span class="p">:</span> <span class="n">rule2</span> <span class="o">|</span> <span class="s1">'a'</span>
<span class="n">rule2</span><span class="p">:</span> <span class="n">rule3</span> <span class="o">|</span> <span class="s1">'b'</span>
<span class="n">rule3</span><span class="p">:</span> <span class="n">rule1</span> <span class="o">|</span> <span class="s1">'c'</span>
</pre></div>
</div>
<p>and “hidden left-recursion” like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>rule: 'optional'? rule '@' some_other_rule
</pre></div>
</div>
</section>
<section id="syntax-error-related-rules">
<h2>Syntax error related rules<a class="headerlink" href="#syntax-error-related-rules" title="Permalink to this headline">¶</a></h2>
<p>Rules meant to provide better error reporting on syntax error are useful
but can be tricky:</p>
<ul class="simple">
<li><p>they will prevent the parser from back tracking which may not always
be desirable. In those cases one can customize the parser to delay
the error reporting.</p></li>
<li><p>secondly when used in the alternative of another rule, this
alternative will never evaluate its action. This can be annoying to
measure the code coverage on the parser. To alleviate this issue, all
rule alternatives making use of a rule whose name starts with
<code class="docutils literal notranslate"><span class="pre">'invalid'</span></code> will have its action set to <code class="docutils literal notranslate"><span class="pre">UNREACHABLE</span></code> if no
action was specified. <code class="docutils literal notranslate"><span class="pre">UNREACHABLE</span></code> is a special action which will
be replaced by the value of the <code class="docutils literal notranslate"><span class="pre">unreachable_formatting</span></code> which
defaults to <code class="docutils literal notranslate"><span class="pre">None</span>  <span class="pre">#</span> <span class="pre">pragma:</span> <span class="pre">no</span> <span class="pre">cover</span></code>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Rules making use of the <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> forced operator to generate syntax error
will never run their action and need to be manually annotated.</p>
</div>
</section>
<section id="customizing-the-generated-parser">
<h2>Customizing the generated parser<a class="headerlink" href="#customizing-the-generated-parser" title="Permalink to this headline">¶</a></h2>
<p>By default, the generated parser inherits from the Parser class defined
in pegen/parser.py, and is named GeneratedParser. One can customize the
generated module by modifying the header and trailer of the module
generated by pegen. To do so one can add dedicated sections to the
grammar, which are discussed below:</p>
<section id="class-name">
<h3>@class NAME<a class="headerlink" href="#class-name" title="Permalink to this headline">¶</a></h3>
<p>This allows to specify the name of the generated parser.</p>
</section>
<section id="header">
<h3>@header<a class="headerlink" href="#header" title="Permalink to this headline">¶</a></h3>
<p>Specify the header of the module as a string (one can typically use
triple quoted string). This defaults to MODULE_PREFIX by default which
is defined in pegen.python_generator. In general you should not modify
the header since it defines necessary imports. If you need to add extra
imports use the next section. Note that the header is formatted using
<code class="docutils literal notranslate"><span class="pre">.format(filename=filename)</span></code> allowing you to embed the grammar
filename in the header.</p>
</section>
<section id="subheader">
<h3>@subheader<a class="headerlink" href="#subheader" title="Permalink to this headline">¶</a></h3>
<p>Specify a subheader for the module as a string (one can typically use
triple quoted string). This is empty by default and is the safer to edit
to perform custom imports.</p>
</section>
<section id="trailer">
<h3>@trailer<a class="headerlink" href="#trailer" title="Permalink to this headline">¶</a></h3>
<p>Specify a trailer for the module which is appended to the parser
definition. It defaults to MODULE_SUFFIX which is defined in
pegen.python_generator. Note that the trailer is formatted using
<code class="docutils literal notranslate"><span class="pre">.format(class_name=cls_name)</span></code> allowing you to reference the created
parser in the trailer.</p>
<p>The following snippets illustrates naming the parser MyParser and making
the parser inherit from a custom base class.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@class</span> <span class="n">MyParser</span>

<span class="nd">@subheader</span> <span class="s1">'''</span>
<span class="s1">from my_package import BaseParser as Parser</span>
<span class="s1">'''</span>
</pre></div>
</div>
</section>
</section>
<section id="style">
<h2>Style<a class="headerlink" href="#style" title="Permalink to this headline">¶</a></h2>
<p>This is not a hard limit, but lines longer than 110 characters should
almost always be wrapped. Most lines should be wrapped after the opening
action curly brace, like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">really_long_rule</span><span class="p">[</span><span class="n">expr_ty</span><span class="p">]:</span> <span class="n">some_arbitrary_rule</span> <span class="p">{</span>
    <span class="n">_This_is_the_action</span> <span class="p">}</span>
</pre></div>
</div>
</section>
</section>

      </article>
      <footer>
        
        <div class="related-pages">
          
          <a class="prev-page" href="peg_parsers.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">About PEG parsers</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021, Pablo Galindo Salgado, Guido van Rossum, Lysandros Nikolaou
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="_sources/grammar.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Syntax</a><ul>
<li><a class="reference internal" href="#grammar-expressions">Grammar Expressions</a><ul>
<li><a class="reference internal" href="#comment"><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">comment</span></code></a></li>
<li><a class="reference internal" href="#e1-e2"><code class="docutils literal notranslate"><span class="pre">e1</span> <span class="pre">e2</span></code></a></li>
<li><a class="reference internal" href="#e1-e2-1"><code class="docutils literal notranslate"><span class="pre">e1</span> <span class="pre">|</span> <span class="pre">e2</span></code></a></li>
<li><a class="reference internal" href="#e"><code class="docutils literal notranslate"><span class="pre">(</span> <span class="pre">e</span> <span class="pre">)</span></code></a></li>
<li><a class="reference internal" href="#e-or-e"><code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">e</span> <span class="pre">]</span> <span class="pre">or</span> <span class="pre">e?</span></code></a></li>
<li><a class="reference internal" href="#e-1"><code class="docutils literal notranslate"><span class="pre">e*</span></code></a></li>
<li><a class="reference internal" href="#e-2"><code class="docutils literal notranslate"><span class="pre">e+</span></code></a></li>
<li><a class="reference internal" href="#s-e"><code class="docutils literal notranslate"><span class="pre">s.e+</span></code></a></li>
<li><a class="reference internal" href="#e-3"><code class="docutils literal notranslate"><span class="pre">&amp;e</span></code></a></li>
<li><a class="reference internal" href="#e-4"><code class="docutils literal notranslate"><span class="pre">!e</span></code></a></li>
<li><a class="reference internal" href="#e-5"><code class="docutils literal notranslate"><span class="pre">~e</span></code></a></li>
<li><a class="reference internal" href="#e-6"><code class="docutils literal notranslate"><span class="pre">&amp;&amp;e</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#keywords">Keywords</a></li>
<li><a class="reference internal" href="#return-value">Return Value</a></li>
<li><a class="reference internal" href="#variables-in-the-grammar">Variables in the Grammar</a></li>
<li><a class="reference internal" href="#grammar-actions">Grammar actions</a></li>
<li><a class="reference internal" href="#left-recursion">Left recursion</a></li>
<li><a class="reference internal" href="#syntax-error-related-rules">Syntax error related rules</a></li>
<li><a class="reference internal" href="#customizing-the-generated-parser">Customizing the generated parser</a><ul>
<li><a class="reference internal" href="#class-name">&#64;class NAME</a></li>
<li><a class="reference internal" href="#header">&#64;header</a></li>
<li><a class="reference internal" href="#subheader">&#64;subheader</a></li>
<li><a class="reference internal" href="#trailer">&#64;trailer</a></li>
</ul>
</li>
<li><a class="reference internal" href="#style">Style</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>